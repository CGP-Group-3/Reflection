//import HX711 library (ADC for load cells)
#include "HX711.h"

//import wifi module library
#include <WiFi.h>

//need to define calibration factor for scale
//this can be obtained from running a separate piece of code from
//https://www.instructables.com/Arduino-Bathroom-Scale-With-50-Kg-Load-Cells-and-H/
//calibrate in kg

//variables
HX711 scale;
const char* ssid = "network_ssid"; //network name to connect to
const char* password = "network_password"; //network's password
WiFiClient client;
IPAddress server(000, 000, 00, 0); //put ip address of computer/mirror server in brackets here

//constants for load cell input & load cell output
const LOAD_CELL_OUTPUT = //pin number (dt or dout) (look up datasheet for HX711 part)
const LOAD_CELL_CLOCK = //pin number (sck)

void setup(){
	//set up serial monitor
	Serial.begin(9600);

	//initialise scale
	scale.begin(LOAD_CELL_OUTPUT, LOAD_CELL_CLOCK);

	//connect to network
	WiFi.begin(ssid, password);

	//wait until wifi successfully connects
	while(WiFi.status() != WL_CONNECTED){
		Serial.println("not connected to network");
	}

	//connect to port 3000
	client.connect(server, 3000);
}

void loop(){
	//wait for server (mirror) to tell scale to do something
	while(client.available()){
		//check if there are things sent from server
		char a = client.read();

		//if server tells scale to weigh user then
		//break out of while loop
		if(a == "weigh user"){
			break;
		}
	}

	//check if the scale is ready to measure & there is pressure/
	//user is standing on the scale. weigh user if yes
	if(scale.is_ready() && load cell reading > 0){
		//call function to get john's weight
		long weight = weighUser();

		//call function to get john's body fat %
		long bodyfat = measureBodyFat();

		//call function to send weight & body fat % to mirror/Processing
		sendMeasurements(weight, bodyfat);
	}
}

long weighUser(){
	long w = scale.read();
	return w;
}

long measureBodyFat(){
	long b;
	//perform bioelectrical impedance analysis
	//send short & small current to electrodes under 1 foot/on one side of scale
	//wait for current to return via other electrodes on other side of scale
	//use Ohm's Law to calculate resistance
	//store resistance in variable b
	return b;
}

void sendMeasurements(long w, long b){
	//send weight & bodyfat to server
	client.print(w);
	client.print(b);
}
